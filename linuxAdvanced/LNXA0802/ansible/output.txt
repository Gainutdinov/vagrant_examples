Здравствуйте.

Задание:

1. Установите aptly на вашем виртуальном сервере (команды и вывод сохраните).

```
echo 'deb http://repo.aptly.info/ squeeze main' > /etc/apt/sources.list.d/aptly.list
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ED75B5A4483DA07C
apt-get update && apt-get install aptly
```

2. Создайте сервисного пользователя aptly, от имени которого будет запускаться сервер и кто будет владеть репозиторием пакетов.

```
useradd --no-create-home --system aptly
```

3. Создайте публичный репозиторий rebrainme (команды и вывод сохраните)

```
aptly repo create rebrainme
```

4. Соберите пакет с nginx 1.18 и модулем nginx-module-vts и упакуйте в deb пакет.

```
sed -i  's|# deb-src http://mirrors.digitalocean.com/ubuntu/ focal main restricted|deb-src http://mirrors.digitalocean.com/ubuntu/ focal main restricted|g' /etc/apt/sources.list
mkdir src
cd src
apt update 
apt-get build-dep nginx-full -y
git clone https://github.com/vozlt/nginx-module-vts.git
wget https://nginx.org/download/nginx-1.18.0.tar.gz
tar xfvz nginx-1.18.0.tar.gz
cd nginx-1.18.0/
#Here we look for our prefix..
nginx -V |& grep configure\ arguments |sed 's/.*prefix/--prefix/'
#now use it...
#add the end we add  --add-dynamic-module= ../nginx-module-vts/
./configure --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-compat --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_sub_module --add-dynamic-module=../nginx-module-vts/
make modules
cp objs/ngx_http_vhost_traffic_status_module.so /usr/lib/nginx/modules/
echo  "load_module /usr/lib/nginx/modules/ngx_http_vhost_traffic_status_module.so;" > modules-available/90-mod-vhost-traffic-status.conf
ln -s /etc/nginx/modules-available/90-mod-vhost-traffic-status.conf /etc/nginx/modules/enabled/




dpkg-buildpackage -us -uc
https://gist.github.com/blikenoother/7785364
```

5. Добавьте пакет с собранным nginx в ваш репозиторий (команды и вывод сохраните).

```

```

6. Выведите все пакеты в репозитории (команды и вывод сохраните).

```

```

7. Выведите информацию о пакете (команды и вывод сохраните).

```

```

8. Напишите systemd unit для раздачи вашего репозитория, который будет перезапускаться при возникновении проблемы и запустите его (сохраните команды вывода unit файла, его запуска и вывод данных команд).

```

```

9. Добавьте ваш репозиторий в локальной виртуальной машине и выведите информацию о пакете при помощи команды apt-cache show (команды и вывод сохраните).


```

```


